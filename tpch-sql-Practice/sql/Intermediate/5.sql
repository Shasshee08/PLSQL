SELECT *
FROM (
    SELECT
        N.N_NAME AS NATION_NAME,
        S.S_NAME AS SUPPLIER_NAME,
        SUM(L.L_EXTENDEDPRICE * (1 - L.L_DISCOUNT)) AS TOTAL_REVENUE,
        RANK() OVER (PARTITION BY N.N_NAME ORDER BY SUM(L.L_EXTENDEDPRICE * (1 - L.L_DISCOUNT)) DESC) AS RNK
    FROM
        SUPPLIER S
    JOIN
        NATION N ON S.S_NATIONKEY = N.N_NATIONKEY
    JOIN
        LINEITEM L ON S.S_SUPPKEY = L.L_SUPPKEY
    GROUP BY
        N.N_NAME, S.S_NAME
)
WHERE RNK = 1
ORDER BY TOTAL_REVENUE DESC;
